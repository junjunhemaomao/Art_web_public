# æ­¦å™¨åŠ¨ç”»ç³»ç»Ÿä¸å¼•æ“ä½¿ç”¨çš„è®¾è®¡å’Œå®ç° 

## é‡‡ç”¨UE Mannequinéª¨éª¼è§„èŒƒçš„äº”å¤§æ ¸å¿ƒä¼˜åŠ¿  
**â€‹ï¼ˆæ— éœ€å¤æ‚é€‚é…ï¼Œæœ€å¤§åŒ–åˆ©ç”¨å¼•æ“ç”Ÿæ€ï¼‰â€‹**  

### 1. åŠ¨ç”»èµ„æºå³ç”¨  
â–¸ ç›´æ¥å…¼å®¹90%å•†åŸåŠ¨ç”»ï¼ˆæˆ˜æ–—/è·‘åŠ¨/äº¤äº’ï¼‰  
â–¸ å…å»éª¨éª¼é‡å®šå‘è°ƒè¯•ï¼Œé™ä½åŠ¨ç”»æ’•è£‚é£é™©  

### 2. ç‰©ç†ç³»ç»Ÿå¼€ç®±å³ç”¨  
â–¸ è‡ªåŠ¨é…ç½®è§’è‰²ç¢°æ’ä½“ï¼ˆèƒ¶å›Šä½“/çƒä½“ï¼‰  
â–¸ å†…ç½®å¸ƒæ–™é”šç‚¹ï¼ˆ`cloth_hip`/`cloth_chest`ï¼‰  

### 3. å·¥ä¸šåŒ–å¼€å‘æµæ°´çº¿  
â–¸ å›¢é˜Ÿåä½œæ— éœ€é‡å¤é€ è½®å­  
â–¸ è·¨é¡¹ç›®èµ„äº§å¤ç”¨ç‡æå‡300%+  

### 4. å¼•æ“çº§åŠ¨ç”»ä¼˜åŒ–  
â–¸ åŸç”Ÿæ”¯æŒControl Rigé€»è¾‘ç»‘å®š  
â–¸ å®Œç¾é©±åŠ¨IKç³»ç»Ÿï¼ˆå¦‚æ”€çˆ¬/ç„å‡†å§¿åŠ¿ï¼‰  

### 5. ç‰ˆæœ¬å‡çº§æ— å¿§  
â–¸ UE4â†’UE5å¹³æ»‘è¿ç§»ï¼ˆä¿ç•™åŠ¨ç”»é€»è¾‘ï¼‰  
â–¸ è‡ªåŠ¨ç»§æ‰¿å¼•æ“æ–°ç‰¹æ€§ï¼ˆå¦‚Motion Matchingï¼‰  

**ğŸš€ æ ¸å¿ƒä»·å€¼**ï¼šç”¨20%çš„è§„èŒƒéµå¾ªæˆæœ¬ï¼Œè§£å†³80%çš„åŠ¨ç”»ç³»ç»Ÿç—›ç‚¹ã€‚  

## å®ç°åŸç†
ä¸ºäº†ä¿æŒæ­¦å™¨ç³»ç»Ÿçš„å¯æ‰©å±•ï¼Œè§’è‰²åŠ¨ç”»å’Œæ­¦å™¨åŠ¨ç”»è§£è€¦ï¼Œä½¿ç”¨æ’æ§½ï¼ˆSocketï¼‰çš„æ–¹æ¡ˆï¼Œè®©æ­¦å™¨ç»‘å®šç³»ç»Ÿå’Œèº«ä½“ç»‘å®šç³»ç»Ÿåˆ†ç¦»   

- å¦‚æœæ­¦å™¨åªæœ‰åˆ€å‰‘ç­‰æ²¡åŠ¨ç”»çš„é™æ€ç‰©ä½“ï¼Œä¸¤ç§æ–¹å¼åŒºåˆ«ä¸å¤§    
- å¦‚æœæ­¦å™¨æœ‰åŠ¨ç”»ï¼Œæ­¦å™¨éª¨éª¼å’Œèº«ä½“åšä¸€ä½“ï¼Œæ­¦å™¨æ²¡æœ‰æ‰©å±•æ€§ï¼Œä¸”å’Œè§’è‰²åŠ¨ç”»å¼ºè€¦åˆ    
- ä»»ä½•é™æ€ç½‘æ ¼ä½“ï¼ˆStatic Meshï¼‰æˆ–éª¨éª¼ç½‘æ ¼ä½“ï¼ˆSkeletal Meshï¼‰éƒ½å¯ä»¥åŠ¨æ€æŒ‚è½½åˆ°æ’æ§½ä¸Šã€‚  
> æ¨¡æ‹Ÿæ‰‹è‡‚å’Œæ­¦å™¨ã€‚ä¸¤ä¸ªç‹¬ç«‹çš„åŠ¨ç”»ç³»ç»Ÿ     

![alt text](./rig1.gif)   

## æ’æ§½æ•°æ®åŒæ­¥  
éœ€è¦Mayaæ­¦å™¨çš„æŒ‚ç‚¹è¾“å‡ºåæ ‡ä¿¡æ¯ï¼Œæä¾›ç»™Unrealä¸­çš„æ’æ§½åŒæ­¥   
jsonæ–‡ä»¶ä¿å­˜åœ¨å·¥ç¨‹è·¯å¾„ä¸‹dataæ–‡ä»¶å¤¹ä¸‹  
```
import maya.cmds as cmds
import json
import os

# è·å–å½“å‰é€‰æ‹©çš„ç‰©ä½“
selected_objects = cmds.ls(selection=True)

# æ£€æŸ¥æ˜¯å¦é€‰æ‹©äº†ç‰©ä½“
if not selected_objects:
    print("No objects selected. Please select a locator or control object.")
else:
    # è·å–é€‰æ‹©çš„ç¬¬ä¸€ä¸ªç‰©ä½“ä½œä¸ºæŒ‚ç‚¹
    socket_name = selected_objects[0]
    
    # è·å–ç‰©ä½“çš„æœ¬åœ°å˜æ¢
    try:
        translate = cmds.getAttr(f"{socket_name}.translate")[0]
        rotate = cmds.getAttr(f"{socket_name}.rotate")[0]
    except Exception as e:
        print(f"Error while getting transform data for {socket_name}: {e}")
        exit()

    # æ„å»ºæ•°æ®
    socket_data = {
        "name": socket_name,
        "location": {"x": translate[0], "y": translate[1], "z": translate[2]},
        "rotation": {"x": rotate[0], "y": rotate[1], "z": rotate[2]},
    }

    # è·å– Maya å·¥ç¨‹è·¯å¾„
    project_path = cmds.workspace(q=True, rootDirectory=True)

    # è®¾ç½®å¯¼å‡ºè·¯å¾„ (å·¥ç¨‹è·¯å¾„ä¸‹çš„ data æ–‡ä»¶å¤¹)
    export_folder = os.path.join(project_path, "data")
    if not os.path.exists(export_folder):
        os.makedirs(export_folder)  # å¦‚æœæ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»º

    export_path = os.path.join(export_folder, f"{socket_name}_socket_data.json")

    # å¯¼å‡ºåˆ° JSON
    with open(export_path, "w") as f:
        json.dump(socket_data, f, indent=4)

    print(f"Socket data exported successfully to {export_path}!")
```
æ•°æ®ç¤ºä¾‹ç»“æœï¼š 
```
{
    "name": "WeaponSocket_Locator",
    "location": {
        "x": 34.87415616288925,
        "y": 97.2246691574479,
        "z": -7.911222900529021
    },
    "rotation": {
        "x": -22.946276037348976,
        "y": 3.8551410351372555,
        "z": -81.16297601679955
    }
}
```
Mayaè½¯ä»¶UIæ˜¾ç¤ºçš„ç²¾åº¦æœ‰è£å‰ªã€‚å¯ä»¥çœ‹åˆ°å¦‚æœæ‰‹åŠ¨å¯¹ä½æ˜¯ä¸å¯èƒ½ç²¾ç¡®å¯¹ä¸Šçš„   

## æ­¦å™¨çº¦æŸåŠå¯¼å‡º
åˆ¶ä½œçš„å…³é”®ç‚¹åœ¨äº**ä½¿ç”¨çº¦æŸ**æ¥ä¿æŒè§’è‰²ä¸æ­¦å™¨åŠ¨ç”»çš„ä¸€è‡´æ€§ï¼Œè€Œä¸æ˜¯ç›´æ¥å°†æ­¦å™¨ä½œä¸ºè§’è‰²éª¨éª¼çš„å­èŠ‚ç‚¹ã€‚  
é€šè¿‡çº¦æŸï¼Œå¯ä»¥ç‹¬ç«‹ç®¡ç†è§’è‰²å’Œæ­¦å™¨çš„éª¨éª¼å±‚çº§ï¼Œåˆ¶ä½œå®Œæˆåè§£é™¤çº¦æŸï¼Œè®©æ­¦å™¨å›å½’åŸç‚¹å¹¶å¯¼å‡ºç‹¬ç«‹åŠ¨ç”»ã€‚ 

- æ·»åŠ ä¸€ä¸ªäºŒçº§æ§åˆ¶å™¨ï¼Œç”¨äºç²¾ç¡®è°ƒæ•´æ­¦å™¨ä¸æ‰‹éƒ¨äº¤äº’çš„å§¿æ€
- ä¸€çº§æ§åˆ¶å™¨åªç”¨æ¥åˆ‡æ¢çº¦æŸè·Ÿéšï¼Œä¸“æ³¨äºçˆ¶å­çº¦æŸçš„åˆ‡æ¢ã€‚  

åŠ¨ç”»å®Œæˆåï¼š
   1. è§£é™¤ä¸€çº§æ§åˆ¶å™¨çš„çº¦æŸ
   2. æ­¦å™¨ä¸€çº§æ§åˆ¶å™¨å›å½’ä¸–ç•Œåæ ‡åŸç‚¹  
   3. çƒ˜ç„™æ­¦å™¨åŠ¨ç”»
   4. å¯¼å‡ºæ­¦å™¨åŠ¨ç”»  

ç‰¹åˆ«è¦æ³¨æ„ï¼Œæ­¦å™¨ä¸€çº§æ§åˆ¶å™¨æœ‰æ²¡æœ‰è¢«KEYä¸ŠåŠ¨ç”»ï¼Œè¿™é‡Œæ˜¯é”™ä½å‘ç”Ÿçš„å…³é”®ç‚¹  
> æ¨¡æ‹Ÿæ‰‹è‡‚å’Œæ­¦å™¨ã€‚æ­¦å™¨ç³»ç»Ÿåœ¨æ‰‹æ§åˆ¶å™¨çš„çº¦æŸä¸‹è¿›è¡ŒåŠ¨ç”»   

![alt text](./rig2.gif)    
å¦‚æœéœ€è¦é¢‘ç¹è§£é™¤çº¦æŸå¹¶å°†æ­¦å™¨å›å½’åŸç‚¹ï¼Œå¯ä»¥é€šè¿‡ Maya è„šæœ¬ç®€åŒ–æµç¨‹ï¼š
```
import maya.cmds as cmds

def bake_and_reset_selected():
    controller = cmds.ls(selection=True)
    # è·å–ä¸æ§åˆ¶å™¨å…³è”çš„çº¦æŸèŠ‚ç‚¹
    constraint_nodes = cmds.listConnections(controller, type="constraint") or []

    # åˆ é™¤çº¦æŸ
    for constraint in constraint_nodes:
        if cmds.objExists(constraint):
            cmds.delete(constraint)

    # é‡ç½®æ§åˆ¶å™¨çš„ä½ç½®å’Œæ—‹è½¬åˆ°åŸç‚¹
    cmds.setAttr(f"{controller}.translate", 0, 0, 0)
    cmds.setAttr(f"{controller}.rotate", 0, 0, 0)

    # çƒ˜ç„™åŠ¨ç”»
    start_frame = cmds.playbackOptions(q=True, min=True)
    end_frame = cmds.playbackOptions(q=True, max=True)
    cmds.bakeResults(controller, t=(start_frame, end_frame))

    print(f"Operation completed for {controller}.")

bake_and_reset_selected()
```
## æ­¦å™¨çº¦æŸåˆ‡æ¢
æœ‰å¾ˆå¤šæƒ…å†µï¼Œè§’è‰²ä¸æ­¢ä¸€ä¸ªæŒ‚è½½ç‚¹ï¼Œä¼šä»èº«ä¸Šåˆ‡æ¢   
åŸåˆ™æ˜¯æŠŠåˆ‡æ¢æ§åˆ¶å±æ€§åšåœ¨æ­¦å™¨æ ¹æ§åˆ¶å™¨ä¸Šï¼Œå…³è”èº«ä½“ä¸åŒéƒ¨ä½çš„çˆ¶å­çº¦æŸå€¼çš„åˆ‡æ¢ï¼Œåšåˆ°åˆ‡æ¢ä¸åŒçš„è·Ÿéšç›®æ ‡     
é€šè¿‡å±æ€§æ§åˆ¶çˆ¶å­çº¦æŸçš„æƒé‡ï¼Œæ–¹ä¾¿åœ¨æ­¦å™¨ä¸åŒçš„æºå¸¦çŠ¶æ€ï¼ˆä¾‹å¦‚æ‰‹æŒã€èƒŒæŒ‚ã€è…°æŒ‚ï¼‰ä¹‹é—´åˆ‡æ¢ã€‚  
åœ¨æ­¦å™¨æ ¹æ§åˆ¶å™¨ä¸Šæ·»åŠ è‡ªå®šä¹‰æšä¸¾å±æ€§ï¼ˆä¾‹å¦‚ FollowTargetï¼‰ã€‚
```
import maya.cmds as cmds

selected_objects = cmds.ls(selection=True)

if not selected_objects:
    print("No objects selected. Please select a control object.")
else:
    for obj in selected_objects:
        if not cmds.attributeQuery("FollowTarget", node=obj, exists=True):
            cmds.addAttr(
                obj,
                longName="FollowTarget",
                attributeType="enum",
                enumName="RightHand:LeftHand:Back:Waist",
                keyable=True
            )
            print("Added 'FollowTarget' attribute to {}".format(obj))
        else:
            print("Object {} already has the 'FollowTarget' attribute.".format(obj))
```  
ä½¿ç”¨ Maya çš„ Set Driven Keyï¼ˆSDKï¼‰ æˆ–è„šæœ¬å°† FollowTarget å±æ€§é©±åŠ¨æ¯ä¸ªçˆ¶å­çº¦æŸçš„æƒé‡ã€‚  
çº¦æŸçš„ç‚¹çš„å‘½åéœ€è¦æŒ‰å·¥ç¨‹æƒ…å†µè¿›è¡Œä¿®æ”¹åˆ¶å®š  
```
def switch_follow_target(target):
    follow_targets = {
        "RightHand": [1, 0, 0, 0],
        "LeftHand": [0, 1, 0, 0],
        "Back": [0, 0, 1, 0],
        "Waist": [0, 0, 0, 1]
    }
    weights = follow_targets.get(target, [0, 0, 0, 0])
    cmds.setAttr("Weapon_Root_RightHandConstraint.w0", weights[0])
    cmds.setAttr("Weapon_Root_LeftHandConstraint.w1", weights[1])
    cmds.setAttr("Weapon_Root_BackConstraint.w2", weights[2])
    cmds.setAttr("Weapon_Root_WaistConstraint.w3", weights[3])

switch_follow_target("Back")  # ç¤ºä¾‹åˆ‡æ¢åˆ°èƒŒæŒ‚ç‚¹
```  
éœ€è¦è¯´æ˜çš„æ˜¯ï¼š  
å³ä½¿åœ¨ Maya ä¸­åˆ‡æ¢äº†ä¸åŒæŒ‚ç‚¹ï¼Œæœ€ç»ˆå¯¼å…¥ Unreal çš„åŠ¨ç”»ï¼Œæ­¦å™¨çš„ä½ç½®å’Œæ—‹è½¬ä¾ç„¶åªéœ€è¦ä¸ åˆå§‹æŒ‚ç‚¹ï¼ˆSocketï¼‰ å¯¹é½å³å¯ã€‚é™¤éæœ‰é€»è¾‘ä¸Šçš„éœ€è¦ï¼Œå¯ä»¥æ“ä½œå…¶ä½™æ’æ§½ã€‚    
åœ¨ Maya ä¸­åˆ‡æ¢æŒ‚ç‚¹çš„çº¦æŸåªæ˜¯ä¸ºäº†æ–¹ä¾¿åˆ¶ä½œåŠ¨ç”»ã€‚ 
## æ¨èå·¥ä½œæµ   
1. Maya ç”¨äºåˆå§‹å¯¹é½   
åœ¨ Maya ä¸­è®¾ç½®å¥½æŒ‚ç‚¹ï¼ˆLocator æˆ–è¾…åŠ©éª¨éª¼ï¼‰ï¼š  
    å¸®åŠ©åŠ¨ç”»å¸ˆç²¾ç¡®åˆ¶ä½œäº¤äº’åŠ¨ç”»ã€‚
    å¯¼å‡ºåˆå§‹ä½ç½®å’Œæ—‹è½¬ä½œä¸º Unreal æ’æ§½çš„å‚è€ƒã€‚
2. Unreal ä¸­å®Œå–„æ’æ§½
åœ¨ Unreal ä¸­ï¼Œå°† Maya çš„æŒ‚ç‚¹è½¬æ¢ä¸ºæ’æ§½ï¼š
    é€šè¿‡æ‰‹åŠ¨è®¾ç½®æ’æ§½ä½ç½®å’Œæ—‹è½¬ï¼Œä¿®æ­£å¯èƒ½çš„åå·®ã€‚
    ä¸ºæ’æ§½å‘½åï¼Œæ–¹ä¾¿è“å›¾é€»è¾‘è°ƒç”¨ã€‚
åœ¨æ¸¸æˆé€»è¾‘ä¸­åˆ©ç”¨æ’æ§½çš„åŠ¨æ€ç‰¹æ€§å®ç°é«˜çº§åŠŸèƒ½ï¼ˆå¦‚æ­¦å™¨åˆ‡æ¢ã€æŒ‚è½½é¥°å“ç­‰ï¼‰ã€‚

## ç»“è®º
Maya ä¸­çš„æŒ‚ç‚¹æ˜¯åˆ¶ä½œåŠ¨ç”»çš„å·¥å…·ï¼Œè€Œ Unreal çš„æ’æ§½æ˜¯ç”¨äºè¿è¡Œæ—¶åŠ¨æ€ç®¡ç†æŒ‚è½½ç‰©ä½“çš„ç³»ç»Ÿã€‚äºŒè€…å¯ä»¥å¾ˆå¥½åœ°ç»“åˆä½¿ç”¨ï¼š  
åœ¨ Maya ä¸­å®Œæˆç²¾ç¡®çš„åŠ¨ç”»åˆ¶ä½œã€‚  
åœ¨ Unreal ä¸­ä½¿ç”¨æ’æ§½å®ç°åŠ¨æ€å’Œå®æ—¶çš„çµæ´»æ€§ã€‚  
è¿™ç§åˆ†å·¥å¯ä»¥æœ€å¤§é™åº¦åœ°æå‡å·¥ä½œæµæ•ˆç‡å’Œç³»ç»Ÿçµæ´»æ€§ã€‚  

[3dmsxæ“ä½œ](https://www.bilibili.com/video/BV1u14y1z7kG/?spm_id_from=333.337.search-card.all.click&vd_source=9cdd98cc53d87aeb4190d2743832662b)