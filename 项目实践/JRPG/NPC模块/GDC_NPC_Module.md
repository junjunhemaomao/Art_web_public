
# **Game Design Document (GDC): NPC 模块**

---

## **1. 项目概述**

### **1.1 模块名称**
NPC模块

### **1.2 模块简介**
NPC模块是游戏中非玩家角色（NPC）的功能实现，包括行为逻辑、对话系统、任务集成、动画表现和事件支持。该模块旨在提供多样化的角色表现和交互体验，增强游戏世界的沉浸感。

### **1.3 模块目标**
- 提供一个可扩展的 NPC 框架，支持不同类型的 NPC 功能需求。
- 提供灵活的工具支持，便于策划和美术团队定义 NPC 数据。

---

## **2. 功能设计**

### **2.1 NPC分类**

| **类型**     | **描述**                                 | **示例**           |
|--------------|------------------------------------------|--------------------|
| 普通村民     | 不参与任务或剧情，仅提供背景对话。       | 村庄中的老奶奶。   |
| 商人         | 出售和购买物品，支持交易界面。           | 武器店老板。       |
| 任务角色     | 提供任务或引导玩家完成任务。             | 守城门的士兵。     |
| 剧情角色     | 关键剧情角色，有丰富对话和特定事件。     | 王国的公主。       |

---

### **2.2 功能模块**

#### **2.2.1 基础信息与属性**
NPC的基础信息包括身份标识、类型、名字和活动区域。

```json
{
  "id": "npc_001",
  "name": "村民阿明",
  "type": "普通村民",
  "region": "初始村庄",
  "dialogue_set": "dialogue_villager1"
}
```

#### **2.2.2 行为逻辑**
定义NPC的行为方式，例如静止、巡逻或事件触发。

```json
{
  "id": "npc_001",
  "behavior_type": "固定",
  "path": [],
  "trigger_on_interact": true
}
```

#### **2.2.3 对话系统**
动态对话的内容管理，支持多条件匹配。

```json
{
  "id": "npc_001",
  "base_dialogue": "你好，勇者！今天是个好天气。",
  "conditions": [
    {
      "condition": "任务完成(quest_001)",
      "dialogue": "感谢你帮助村庄！"
    },
    {
      "condition": "时间(夜晚)",
      "dialogue": "天黑了，该休息了。"
    }
  ]
}
```

#### **2.2.4 任务系统集成**
NPC可与任务系统关联，触发任务或响应任务完成状态。

```json
{
  "id": "npc_003",
  "quest_id": "quest_001",
  "trigger_condition": "玩家靠近并交互",
  "reward": {
    "gold": 100,
    "item": "钥匙×1"
  }
}
```

#### **2.2.5 动画与表现**
NPC的动画状态定义，包括默认状态、行为切换和事件动画。

```json
{
  "id": "npc_001",
  "default_animation": "Idle",
  "event_animations": {
    "greet": "Wave",
    "cheer": "Cheer"
  }
}
```

#### **2.2.6 事件与脚本支持**
支持复杂的事件逻辑与条件执行。

```json
{
  "id": "npc_002",
  "event_type": "物品给予",
  "event_condition": "玩家拥有钥匙(key_001)",
  "event_action": "开启门(gate_01)"
}
```

---

## **3. 技术设计**

### **3.1 数据管理**
NPC模块的所有数据使用 JSON 格式存储，通过工具导入到游戏引擎中。以下是核心数据结构：

#### **3.1.1 NPC基础数据**
```json
{
  "id": "npc_001",
  "name": "村民阿明",
  "type": "普通村民",
  "region": "初始村庄"
}
```

#### **3.1.2 NPC行为数据**
```json
{
  "id": "npc_001",
  "behavior_type": "巡逻",
  "path": ["(10, 10)", "(15, 15)", "(20, 10)"],
  "trigger_on_interact": true
}
```

#### **3.1.3 NPC对话数据**
```json
{
  "id": "npc_001",
  "base_dialogue": "你好，勇者！今天是个好天气。",
  "conditions": [
    {
      "condition": "时间(早晨)",
      "dialogue": "早上好，勇者！今天要去哪儿呢？"
    },
    {
      "condition": "任务完成(quest_002)",
      "dialogue": "谢谢你救了我的孩子！"
    }
  ]
}
```

### **3.2 系统架构**
NPC模块基于以下技术构建：
1. **状态机**：控制NPC的行为状态。
2. **事件系统**：管理NPC与任务或玩家的交互逻辑。
3. **数据驱动**：所有NPC数据从外部加载，支持动态扩展。

---

## **4. UI/UX设计**

### **4.1 交互提示**
- 玩家靠近NPC时，显示交互提示（例如“按E与阿明交谈”）。

### **4.2 对话框设计**
- 对话框支持以下功能：
  - 显示NPC头像和名字。
  - 动态文字滚动显示。
  - 支持多分支选择。
  
示例对话框：

```
阿明: 你好，勇者！今天是个好天气。
[1] 今天很适合探险。
[2] 我只是路过。
```

---

## **5. 测试计划**

### **5.1 功能测试**
- 验证NPC的基础行为（如站立、巡逻）是否正常。
- 测试对话逻辑是否符合条件触发。
- 检查任务触发和完成的集成效果。

### **5.2 压力测试**
- 测试同屏50个NPC是否保持帧率稳定。

### **5.3 异常测试**
- 确保NPC不会因条件未触发而卡住行为。
- 验证与任务、动画的交互是否正常。

---

## **6. 数据模板**

### **6.1 Excel模板字段**
| **字段名**          | **描述**                 |
|---------------------|--------------------------|
| ID                  | NPC唯一标识符            |
| Name                | NPC名字                 |
| Type                | NPC类型                 |
| Region              | 所在区域                |
| Behavior Type       | 行为类型                |
| Path                | 巡逻路径                |
| Dialogue Set        | 对话集合引用名          |
| Trigger On Interact | 是否触发交互事件        |

---

通过以上 Markdown 格式编写的完整 GDC 文档，开发团队可以快速获取 NPC 模块的功能定义和数据结构，方便开发和测试工作。
