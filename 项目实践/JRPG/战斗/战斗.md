
# 战斗逻辑

## 战斗属性

- **攻击力（ATK）**：角色或怪物的物理攻击力，用于计算物理伤害。  
- **防御力（DEF）**：角色或怪物的物理防御力，用来减少受到的物理伤害。   
- **魔法攻击力（MATK）**：角色或怪物的魔法攻击力，用于计算魔法伤害。   
- **魔法抗性（MDEF）**：角色或怪物的魔法抗性，用来减少受到的魔法伤害。   
- **速度（SPD）**：影响回合顺序，但对伤害计算的直接影响较小。   
- **技能伤害系数（Skill Coefficient）**：特定技能或攻击的基础伤害系数。  
- **暴击概率（Critical Rate）**：触发暴击的几率，用于决定是否造成额外伤害。  
- **暴击系数（Critical Coefficient）**：暴击时伤害的倍率，通常大于1。  
- **闪避概率（Dodge Rate）**：触发闪避的几率，决定是否完全规避攻击。  

---

## 战斗计算  

> 每一回合只能选择一种攻击方式，分为物理攻击（武技）和魔法攻击（道法）两种。  
> 某些特定技能（如大招）会结合物理和魔法攻击的伤害，需叠加计算。  
> **总伤害** = **物理伤害** + **魔法伤害**

### **伤害公式**

#### 1. 物理伤害计算公式  
```
物理伤害 = [(攻击力 × 技能系数) - 防御力] × 随机波动
```
- **随机波动**：用于模拟伤害的浮动，通常取 0.9 ~ 1.1 范围的随机值。

#### 2. 魔法伤害计算公式  
```
魔法伤害 = [(魔法攻击力 × 技能系数) - 魔法抗性] × 随机波动
```
- 魔法伤害同样受到**随机波动**影响，与物理伤害一致。

#### 3. 批量攻击与全体技能伤害
```
全体伤害 = 技能伤害 ÷ 目标数
```
- **说明**：全体伤害的值会被分摊到每个目标。例如：
  - “天雷灭世诀”对全体敌人造成175点总伤害，目标数为4：
  ```
  全体伤害 = 175 ÷ 4 = 43.75
  ```

---

### **暴击与闪避**
![alt text](./image.png)   
#### 1. 暴击计算
- 玩家或怪物攻击前投掷两个20面骰，分别记为 D1 和 D2。
- 如果两颗骰子的点数之和大于等于暴击触发阈值，则触发暴击。  
```
是否暴击 = (D1 + D2 + 装备修正值) ≥ 暴击阈值
```
- 暴击成立时，伤害计算公式为：  
```
实际伤害 = 普通伤害 × 暴击系数
```
- **注意**：暴击概率可以通过技能或装备提高（装备修正值），但暴击系数通常是固定值（如1.5或2.0）。

#### 2. 闪避计算
- 每回合攻击时根据**闪避概率**触发闪避：  
```
是否闪避 = 随机数 ≤ 闪避概率
```
- 闪避成功时，本次攻击直接无效，不计算伤害。
- **闪避概率**与攻击方的命中率强相关：
```
实际命中率 = 攻击方命中率 × (1 - 防守方闪避率)
```

---

### **逃跑机制**

- 逃跑成功的概率由玩家和怪物的**等级差**决定。  
- **逃跑概率公式**：
```
逃跑成功率 = 基础逃跑率 + (玩家等级 - 怪物等级) × 等级系数
```
- 如果逃跑失败，敌方可能获得额外攻击机会。

---

### **总结**

战斗属性、伤害计算、暴击与闪避的综合作用，使战斗具备动态变化和策略性。玩家可通过提升暴击率、技能系数等进攻属性，或增加闪避率、抗性等防御属性，优化战斗表现。
